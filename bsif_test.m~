path = '/Users/esvecpar/Documents/datasets/faces_orl';

files = dir(path);

class = 1;
for i=1:numel(files)-2
    d(i) = class;
    if i/10==uint8(i/10)
        class = class+1;
    end
end
d = d';

n = 9;
b = 11;

filename=['ICAtextureFilters_' int2str(n) 'x' int2str(n) '_' int2str(b) 'bit'];
load(filename, 'ICAtextureFilters');

for i1 = 1:numel(files)-2
    i = i1+2;
    I = imread([path '/' files(i).name]);
    %BSIF
    I = bsif(I,ICAtextureFilters,'im'); %'h'); for histogram and 'nh'); for normalized histogram
    
    Y(i1,:) = I(:);
end

[X,d,Xt,dt] = Bds_stratify(Y,d,0.9);

%%

op.k = 10;
ds = Bcl_knn(X,d,Xt,op);   % knn with 10 neighbors
p = Bev_performance(ds,dt) % performance on test data